{% extends 'base.html' %}

{% block title %}Clim-Warn Early warning platform - UNEP{% endblock title %}
{% block extra_head %}
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script src="{{ STATIC_URL }}js/react.js"></script>
<script src="{{ STATIC_URL }}js/react-chartjs.min.js"></script>
<script src="{{ STATIC_URL }}js/JSXTransformer.js"></script>
<link rel="stylesheet" type="text/css" media="screen" href="http://cdnjs.cloudflare.com/ajax/libs/fancybox/1.3.4/jquery.fancybox-1.3.4.css" />
<style type="text/css">
    a.fancybox img {
        border: none;
        box-shadow: 0 1px 7px rgba(0,0,0,0.6);
        -o-transform: scale(1,1); -ms-transform: scale(1,1); -moz-transform: scale(1,1); -webkit-transform: scale(1,1); transform: scale(1,1); -o-transition: all 0.2s ease-in-out; -ms-transition: all 0.2s ease-in-out; -moz-transition: all 0.2s ease-in-out; -webkit-transition: all 0.2s ease-in-out; transition: all 0.2s ease-in-out;
    } 
    a.fancybox:hover img {
        position: relative; z-index: 999; -o-transform: scale(1.03,1.03); -ms-transform: scale(1.03,1.03); -moz-transform: scale(1.03,1.03); -webkit-transform: scale(1.03,1.03); transform: scale(1.03,1.03);
    }

p{
    font-family: 'Lato', sans-serif;
}

/* bootstrap hack: fix content width inside hidden tabs */
.tab-content > .tab-pane,
.pill-content > .pill-pane {
    display: block;     /* undo display:none          */
    height: 0;          /* height:0 is also invisible */ 
    overflow-y: hidden; /* no-overflow                */
}
.tab-content > .active,
.pill-content > .active {
    height: auto;       /* let the content decide it  */
} /* bootstrap hack end */
</style>
{% endblock extra_head %}
{% block case_studies_drop_down_menu %}
<li class="dropdown">
    <a href="#" data-toggle="dropdown" class="dropdown-toggle">Case Studies<b class="caret"></b></a>
    <ul class="dropdown-menu">
        <li><a href="{% url 'kwale' %}">Kwale 2008</a></li>
        <li><a href="{% url 'nzoia' %}">Nzoia 2013</a></li>
        <li><a href="{% url 'turkana' %}">Turkana 2011</a></li>
    </ul>
</li>
{% endblock case_studies_drop_down_menu %}

{% block hazard_title %}
<li>

    <a><strong>CLIM-WARN Early Warning Prototype</strong></a>
</li>
{% endblock hazard_title %}

{% block main_content %}
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/fancybox/1.3.4/jquery.fancybox-1.3.4.pack.min.js"></script>
<script type="text/javascript">
    $(function($){
        var addToAll = false;
        var gallery = true;
        var titlePosition = 'inside';
        $(addToAll ? 'img' : 'img.fancybox').each(function(){
            var $this = $(this);
            var title = $this.attr('title');
            var src = $this.attr('data-big') || $this.attr('src');
            var a = $('<a href="#" class="fancybox"></a>').attr('href', src).attr('title', title);
            $this.wrap(a);
        });
        if (gallery)
            $('a.fancybox').attr('rel', 'fancyboxgallery');
        $('a.fancybox').fancybox({
            titlePosition: titlePosition
        });
    });
    $.noConflict();
</script>
 	<div class="row">
 		<div role="tabpanel">
 			<ul class="nav nav-tabs" id="tablist">
 				<li role="presentation" class="active"><a href="#introduction" aria-controls="introduction" role="tab" data-toggle="tab"><b>Nzoia: Introduction</b></a></li>
                <li role="presentation"><a href="#simulation" aria-controls="simulation" role="tab" data-toggle="tab"><b>Simulation</b></a></li>
                <li role="presentation"><a href="#data" aria-controls="data" role="tab" data-toggle="tab"><b>Data</b></a></li>
 			</ul>
            
 			<div class="tab-content">
 				<div role="tabpanel" class="tab-pane fade in active" id="introduction">
                        <div class="col-xs-10 col-md-offset-1">
                            <br/>
                            
                                <p class="text-left">
                                    The Nzoia River is a 160-mile (257 km) long Kenyan river, rising from Mount Elgon. It flows south and then west, eventually flowing into Lake Victoria near the town of Port Victoria.</p>
                                <p class="text-left">
                                    The river is important to Western Kenya, flowing through a region estimated to be populated by over 3.5 million people. Its waters provide irrigation all year round, while the annual floods around the lowland area of Budalang'i deposit sediment that contributes to the area's good agricultural production.
                                </p>
                                <p class="text-left">
                                    The river has a number of spectacular waterfalls, and is thought to possess a good hydroelectricity generation potential.
                                </p>
                                <p class="text-left">
                                    The area however is prone to flooding especially at this period of long rains April to the end of May. There is catastrophic loss of livestock, houses, land and also human lives increasing poverty levels. The data <a id="#simulation">simulation</a> presented is for the year 2013.
                                </p>
                    
                        <div class="row">
                            <div class="col-md-6 col-md-offset-2" align="center">
                                <img src="{{ STATIC_URL }}img/r-nzoia.jpg" class="thumbnail" align="center">
                            </div>
                            <div class="col-md-3">
                                <a href="http://maps.virtualkenya.org/documents/1225">Lower Nzoia Flood Assessment</a>
                                <br/>
                                <a href="http://maps.virtualkenya.org/documents/970">Messages & Triggers</a>
                                <br/>
                                <a href="http://maps.virtualkenya.org/documents/971">Vulnerablity Metadata</a>
                                <br/>
                            </div>
                        </div>
                    </div>
 				</div>
                <div role="tabpanel" class="tab-pane fade" id="simulation">
                    <div class="row">
                        <div class="col-md-1"></div>
                        <div class="col-md-8">
                            <div id="content">
                                <div id="chart_div" style="height: 200px"></div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div>&nbsp;</div>
                            <button class="btn btn-md btn-block btn-default" data-toggle="modal" data-target="#alertSMS">
                                Send SMS
                            </button>
                            <div>&nbsp;</div>
                            <button class="btn btn-md btn-block btn-default" data-toggle="modal" data-target="#alertEmail">
                                Send Email
                            </button>
                        </div>
                    </div>
                    <div class="row"><hr /></div>
                    <div class="row">
                        <div class="col-md-4">
                            <h4 class="text-center">Hazard</h4>
                            <div>
                                <img id="simulation_hazard" style="max-width: 100%;"  src="https://s3-eu-west-1.amazonaws.com/upande/2_1mdepth.GIF">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h4 class="text-center">Vulnerability</h4>
                            <div>
                                <img id="simulation_vulnerability" style="max-width: 100%;" src="https://s3-eu-west-1.amazonaws.com/upande/Nzoia_Vulnerability.GIF">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h4 class="text-center">Risk</h4>
                            <div>
                                <img style="max-width: 100%;" id="simulation_risk"  src="https://s3-eu-west-1.amazonaws.com/upande/Nzoia_Risk.GIF">
                            </div>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane fade" id="data">
                        <div class="col-md-10 col-md-offset-1">
                            <iframe src="http://maps.virtualkenya.org/maps/900/embed" width='100%' height='500px'></iframe>
                        </div>
                </div>
              
 			</div> 			
 		</div>
 	</div>
 </div>

<div class="modal" id="alertSMS" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">SMS Alert Message</h4>
            </div>
            <form method="POST" id="send_sms_form">{% csrf_token %}
            <div class="modal-body">
                <input type="hidden" name="alert_type" value="SMS" />
                <input type="hidden" name="return_url" value="nzoia" />
                <div class="form-group">
                    <label for="sms_alert_message" class="control-label">Message:</label>
                    <textarea class="alert_message form-control" name="sms_alert_message" readonly="true"></textarea>
                </div>
                <legend>Enter recipient mobile numbers separated by commans<legend>
                <div class="form-group">
                    <label for="recipient-name" class="control-label">Recipient:</label>
                    <input type="text" class="form-control" name="recipients">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <!--<a href="#" id="submit_sms" class="btn btn-primary">Send message</a>-->
                <button type="submit" class="btn btn-primary">Send message</button>
            </div>
            </form>
        </div>
    </div>
</div>

<div class="modal" id="alertEmail" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Email Alert message</h4>
            </div>
            <form method="POST" id="send_email_form">{% csrf_token %}
            <div class="modal-body">
                <input type="hidden" name="alert_type" value="EMAIL" />
                <input type="hidden" name="return_url" value="nzoia" />
                <div class="form-group">
                    <label for="email_alert_message" class="control-label">Message:</label>
                    <textarea class="alert_message form-control" name="email_alert_message" readonly="true"></textarea>
                </div>
                <legend>Enter recipient email addresses separated by commans<legend>
                <div class="form-group">
                    <label for="recipient-name" class="control-label">Recipient:</label>
                    <input type="text" class="form-control" name="recipients">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <!--<a href="#" id="submit_email" class="btn btn-primary">Send message</a> -->
                <button type="submit" class="btn btn-primary">Send message</button>
            </div>
            </form>
        </div>
    </div>
</div>
<script>
    $('#myTab a[href="#simulation"]').tab('show');

    $(document).ready(function () {
        $('.dropdown-toggle').dropdown();
    });    
</script>
<script>
google.load('visualization', '1', {packages: ['corechart', 'line']});
google.setOnLoadCallback(drawChart);



function drawChart () {

    var data = google.visualization.arrayToDataTable([
        ['Date', 'Flood Height'],
        ['2013-01-08', 2.10],
        ['2013-03-01', 1.00],
        ['2013-04-15', 2.60],
        ['2013-04-30', 1.50],
        ['2013-09-11', 3.40]
    ]);
    var options = {
        title: 'Click on reading to generate alerts',
        hAxis: {
            title: 'Date'
        },
        vAxis: {
            title: 'Height'
        },
        backgroundColor: '#FFFFFF',
        pointSize: 10
    };

    var my_chart = new google.visualization.LineChart(document.getElementById('chart_div'));
    my_chart.draw(data, options);
    google.visualization.events.addListener(my_chart, 'select', function() {
        var selection = my_chart.getSelection();
        var row = parseInt(selection[0].row);
        console.log('SELECTION ROW: ' + row );
        //console.log(data);
        switch(row){
            case 0:
                //console.log('row 0');
                $('#simulation_hazard').attr("src", "https://s3-eu-west-1.amazonaws.com/upande/2_1mdepth.GIF");

                $(".alert_message").val("F3 Flood Warning.  Heavy flooding of lower Nzoia floodplains likely.");
                break;
            case 1:
                //console.log('row 1');
                $('#simulation_hazard').attr("src", "https://s3-eu-west-1.amazonaws.com/upande/1_0mdepth.GIF");

                $(".alert_message").val("F2 Flood Alert. Some flooding of lower Nzoia floodplains likely.");
                break;
            case 2:
                $('#simulation_hazard').attr("src", "https://s3-eu-west-1.amazonaws.com/upande/2_6mdepth.GIF");

                $(".alert_message").val("F3 Flood Warning.  Heavy flooding of lower Nzoia floodplains likely.");
                //console.log('row 2');
                break;
            case 3:
                $('#simulation_hazard').attr("src", "https://s3-eu-west-1.amazonaws.com/upande/1_5mdepth.GIF");

                $(".alert_message").val("F2 Flood Alert. Some flooding of lower Nzoia floodplains likely.");
                //console.log('row 3');
                break;
            case 4:
                $('#simulation_hazard').attr("src", "https://s3-eu-west-1.amazonaws.com/upande/3_4mdepth.GIF");

                $(".alert_message").val("F3 Flood Warning.  Heavy flooding of lower Nzoia floodplains likely.");
                //console.log('row 4');
                break;
            default:
                console.log('DEFAULT');

        }
    });
}
</script>

{% endblock main_content %}
