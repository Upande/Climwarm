{% extends 'base.html' %}

{% block title %}Clim-Warn Early warning platform - UNEP{% endblock title %}
{% block extra_head %}
<script type="text/javascript" src="{{ STATIC_URL }}js/Chart.js"></script>

<style>

.vcenter {
        display: inline-block;
        vertical-align: middle;
        float: none;
    }
    
.column{
float:left;
width:550px;
height:300px;
padding:20px;
overflow-y:hidden;

}
</style>
{% endblock extra_head %}
{% block case_studies_drop_down_menu %}
<li class="dropdown">
    <a href="#" data-toggle="dropdown" class="dropdown-toggle">Case Studies<b class="caret"></b></a>
    <ul class="dropdown-menu">
        <li><a href="{% url 'kwale' %}">Kwale 2008</a></li>
        <li><a href="{% url 'nzoia' %}">Nzoia 2013</a></li>
        <li><a href="{% url 'turkana' %}">Turkana 2011</a></li>
    </ul>
</li>
{% endblock case_studies_drop_down_menu %}

{% block hazard_title %}
<li>

    <a><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLIM-WARN Early Warning Prototype</strong></a>
</li>
{% endblock hazard_title %}

{% block main_content %}

 	<div class="row">
 		<div role="tabpanel">
 			<ul class="nav nav-tabs" id="tablist">
 				<li role="presentation" class="active"><a href="#introduction" aria-controls="introduction" role="tab" data-toggle="tab"><b>Nzoia:Introduction</b></a></li>
                <li role="presentation"><a href="#simulation" aria-controls="simulation" role="tab" data-toggle="tab"><b>Simulation</b></a></li>
                <li role="presentation"><a href="#data" aria-controls="data" role="tab" data-toggle="tab"><b>Data</b></a></li>
 			</ul>
            
 			<div class="tab-content">
 				<div role="tabpanel" class="tab-pane fade in active" id="introduction">
                        <div class="col-xs-10">
                            <br/>
                            <p style="bold">
                                The Nzoia River is a 160-mile (257 km) long Kenyan river, rising from Mount Elgon. It flows south and then west, eventually flowing into Lake Victoria near the town of Port Victoria.</p>
                            <p>
                                The river is important to Western Kenya, flowing through a region estimated to be populated by over 3.5 million people. Its waters provide irrigation all year round, while the annual floods around the lowland area of Budalang'i deposit sediment that contributes to the area's good agricultural production.
                            </p>
                            <p>
                                The river has a number of spectacular waterfalls, and is thought to possess a good hydroelectricity generation potential.
                            </p>
                            <br/>
                            <img src="{{ STATIC_URL }}img/r-nzoia.jpg">

                        </div>
 				</div>
                <div role="tabpanel" class="tab-pane fade" id="simulation">
                    <div class="row">
                        <div class="col-md-1"></div>
                        <div class="col-md-8">
                            <div>
                                <canvas id="canvas" height="100" width="600"></canvas>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-md btn-primary btn-block">
                                    Send SMS
                            </button>
                            <button type="submit" class="btn btn-md btn-primary btn-block">
                                    Send Email
                            </button>
                        </div>
                    </div>
                    <div><hr /></div>
                    <div class="row">
                        <div class="col-md-4">
                            <h4 class="text-center">Hazard</h4>
                            <div>
                                <img src="http://maps.virtualkenya.org/geoserver/geonode/wms?service=WMS&version=1.1.0&request=GetMap&layers=geonode:_2013_3_4mdepth&styles=&bbox=33.9464889387558,0.022437748738848712,34.1669959389322,0.18781799887115133&width=512&height=383&srs=EPSG:4326&format=image%2Fgif">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h4 class="text-center">Vulnerability</h4>
                            <div>
                                <img src="http://maps.virtualkenya.org/geoserver/geonode/wms?service=WMS&version=1.1.0&request=GetMap&layers=geonode:nzoia_vulnerability&styles=&bbox=33.8495718598182,-0.03422599985613107,34.279603859818195,0.2882980001438689&width=512&height=384&srs=EPSG:4326&format=image%2Fgif">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h4 class="text-center">Risk</h4>
                            <div>
                                <img src="http://maps.virtualkenya.org/geoserver/geonode/wms?service=WMS&version=1.1.0&request=GetMap&layers=geonode:risk&styles=&bbox=33.951047994315,0.055405651567,34.162665772211,0.154850096067&width=702&height=330&srs=EPSG:4326&format=image%2Fgif">
                            </div>
                        </div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane fade" id="data">
                        <div class="row">
                            <div class="col-xs-6">
                                <!--Hazard-->
                                <iframe width='100%' height='250px' frameborder='0' title src='https://markdb.cartodb.com/viz/4f7d3aa2-e43b-11e4-9361-0e4fddd5de28/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
                            </div>
                            <div class="col-xs-6">
                                <!--Vulnerability-->
                                <iframe width='100%' height='250px' frameborder='0' src='https://markdb.cartodb.com/viz/35fe089a-e43b-11e4-828b-0e0c41326911/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
                            </div>
                        </div
                        <div class="row">
                            <div class="col-xs-6">
                                <!--Risk-->
                                <iframe width='100%' height='250px' frameborder='0' src='https://markdb.cartodb.com/viz/43788c84-e43b-11e4-a5f9-0e018d66dc29/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
                            </div>
                            <div class="col-xs-6">
                                <!--Impact/Response-->
                                <iframe width='100%' height='250px' frameborder='0' src='https://markdb.cartodb.com/viz/9f5e656e-e43b-11e4-8ecf-0e9d821ea90d/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
                            </div>
                        </div>
                </div>
              
 			</div> 			
 		</div>
 	</div>
 </div>
<script src="{{ STATIC_URL }}js/jquery-1.11.2.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}js/bootstrap.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function () {
        $('.dropdown-toggle').dropdown();
    });

    var map_array = new Array();
    {% for reading in readings %}
    map_array['{{ reading.reading_date|date:"d-M" }}'] = '{{ reading.extent_image_file }}'
    {% endfor %}
    var lineChartData = {
        labels: [
            {% for reading in readings %}
            '{{ reading.reading_date|date:"d-M" }}',
            {% endfor %}
        ],
        datasets: [
        {
            label: "readings",
            fillColor : "rgba(151,187,205,0.2)",
            strokeColor : "rgba(151,187,205,1)",
            //pointColor : "rgba(151,187,205,1)",
            pointColor : "red",
            pointStrokeColor : "#fff",
            pointHighlightFill : "#fff",
            pointHighlightStroke : "rgba(151,187,205,1)",
            data: [
                {% for reading in readings %}
                {{ reading.reading }},
                {% endfor %}
            ]

        }
        ]
    }
    window.onload = function() {
        var ctx = document.getElementById("canvas").getContext("2d");
        window.myLineChart = new Chart(ctx).Line(lineChartData, {
            responsive: true
        });
    }

    canvas.onclick = function(evt) {
        var activePoints = myLineChart.getPointsAtEvent(evt);
        if (activePoints[0]) {
            //console.log(activePoints[0]);
            //console.log(activePoints[0].value);
            //console.log(map_array[activePoints[0].label]);
            var image = $('#map_image');
            image.attr("src", map_array[activePoints[0].label]);
        }
        else {
            console.log('not a point');
        }
    };    
</script>

{% endblock main_content %}
